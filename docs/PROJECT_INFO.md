## 1. 서비스 한 줄 요약

- 사용자는 **지갑 로그인 + USDC(x402 결제)** 로 LLM에게 질문을 던지고,
- 맘에 든 대화를 **공유**하면,
  - LLM이 자동으로 **제목·카테고리**를 붙여주고
  - 이 Q&A가 **대시보드 카드**로 올라감.
- 다른 유저들은 카드/대화 상세에서 **좋아요**를 눌러 프롬프트의 인기도를 만들고,
- 이 데이터를 기반으로
  - **모델 랭킹(Model Leaderboard)**: Adoption Rate & Posted
  - **유저 랭킹(User Leaderboard)**: 좋아요 점수 + 공유 수
    를 집계한다.

---

## 2. 플로우 상세

### 2-1. Home – 질문 & 답변 생성

(이 부분은 기존과 동일)

1. 지갑 연결 & USDC approve (PaymentRouter / x402).
2. 사용자가 프롬프트 입력 후 Submit → `/api/chat`.
3. x402 결제 성공 후:
   - Prompt/Answer 생성 (modelId 포함, 모델명은 UI에 숨김).
4. Home 화면에 **프롬프트 + 답변 1개**만 표시.

---

### 2-2. 공유 시 LLM이 제목/카테고리 생성

1. 유저가 Home 화면에서 **공유 버튼** 클릭.
2. 서버에서:
   - `prompt`, `answer`, `modelId`를 LLM에 던져서:
     - **제목(title)** – 카드/상세 상단에 쓸 짧은 문장
     - **카테고리(category)** – 5개 분류 중 하나 (예: `개발`, `비즈니스`, `디자인`, `금융`, `기타`)
       를 자동 생성.
3. DB에:
   - `Prompt` 레코드에 `title`, `category`, `isShared = true` 저장.
4. 이 순간부터 이 Q&A가 **Dashboard 리스트에 노출**된다.

> 나중에 사용자는 상세 페이지에서 제목/카테고리를 수정할 수 있음 (작성자만).

---

## 3. Dashboard – 카드 리스트 & 상세

### 3-1. 카드 리스트 (그리드)

**API 예:** `GET /api/prompts?shared=true&sort=<mode>&category=<cat>`

각 카드에는:

- **제목** – LLM이 생성 (또는 사용자가 수정한 최신 값)
- **카테고리** – 5개 분류 중 하나
- **프롬프트 요약**
  - 너무 길면 앞부분만 자르거나 요약 텍스트 사용
- **모델명**
  - 여기서는 GPT/Qwen 등 실제 모델명 노출
- **작성 시간**
- **좋아요 수**
  - 외부(카드)에서도 좋아요 클릭 가능

**정렬 기능:**

- **전체**: 모든 공유 프롬프트
- **인기순**: 좋아요 수 기준 내림차순
- **최신순**: 작성/공유 시간 기준 내림차순

**카테고리 필터:**

- 상단에 5개 탭 혹은 드롭다운
  - 예: `전체 / 개발 / 비즈니스 / 디자인 / 금융 / 기타`
- 선택 시 해당 카테고리만 필터링

---

### 3-2. 카드 클릭 → 대화 상세 페이지

**API 예:** `GET /api/prompts/:id`

상세 화면에서 보여주는 정보:

- **제목**
- **카테고리**
- **프롬프트 전체**
- **모델명**
- **답변 전체**
- **좋아요 버튼 + 좋아요 수**

**제목/카테고리 수정:**

- 이 대화를 생성한 **작성자 지갑 주소와 현재 로그인 지갑이 같으면**:
  - 제목/카테고리 영역에 “수정” UI 노출
  - 수정 후 `PATCH /api/prompts/:id`로 업데이트

---

### 3-3. 좋아요 중복 방지 규칙

- 좋아요는 **프롬프트 단위**(한 Q&A 하나)로 관리.
- 한 유저는 **어디서든(대시보드 카드든, 상세 페이지든)**
  → **해당 프롬프트에 한 번만 좋아요 가능**.
- 구현적으로:
  - `PromptLike(promptId, userId)`를 유니크 키로 관리.
- UI:
  - 대시보드에서 누른 좋아요가 상세에 가도 반영된 상태(하트 채워짐).
  - 상세에서 누른 좋아요 역시 그리드 카드 숫자와 동기화.

---

## 4. Leaderboard – 모델 & 유저 랭킹 스펙

### 4-1. 모델 랭킹 (Model Leaderboard)

**기본 지표 두 가지:**

1. **Posted**
   - 특정 모델이 답변한 대화 중,
   - **Dashboard에 실제로 공유된 횟수**.
   - 즉: 그 모델이 “카드로 올라간” Q&A 개수.
2. **Adoption Rate (%)**
   - 공식:
     [
     \text{Adoption Rate} = \frac{\text{해당 모델이 답변한 전체 대화 중 공유된 수}}{\text{해당 모델이 답변한 전체 대화 수}} \times 100
     ]
   - 예:
     - A 모델이 전체 대화 100개 답변
     - 그 중 60개가 공유되었으면 → Adoption Rate = 60%

**정렬 로직:**

- 기본: **Adoption Rate 내림차순**
- 같은 비율이면 `Posted` 많은 순으로 정렬
  (실제 사용량도 함께 반영)

**리더보드 화면:**

- 컬럼 예:
  - Rank | Model | Provider | Adoption Rate | Posted
- 설명:
  - Adoption Rate = “유저가 이 모델 답변을 마음에 들어 해서 대시보드에 올린 비율”
  - Posted = “실제 공개된 카드 수(노출량)”

---

### 4-2. 유저 랭킹 (User Leaderboard)

**기본 요소:**

1. **지갑 주소 (축약)**
   - 예: `0x1234...89ab` 형태로 표시
   - 클릭 가능 (클릭하면 해당 유저의 “인기 공유 프롬프트” 목록으로 이동)
2. **좋아요 점수**
   - 이 유저가 **공유한 프롬프트**들이 받은 좋아요 합 × 10점
   - 예: 내가 공유한 Q&A들이 총 37좋아요 → 좋아요 점수 = 370점
3. **공유된 프롬프트 개수**
   - 이 유저가 Dashboard에 올린 프롬프트 수
   - (즉, `isShared = true`인 Prompt 수)

**랭킹 산정:**

- 기본 점수:
  - `totalScore = (likesCount * 10) + sharedPromptCount`
- User Leaderboard는 `totalScore` 내림차순 정렬.

**User Leaderboard 화면:**

- 컬럼 예:
  - Rank | User(지갑) | Likes Score | Shared Prompts | Total Score

**지갑 주소 클릭 시: 인기 공유 프롬프트 목록**

- **API 예:** `GET /api/users/:address/shared-prompts?sort=likes`
- 리스트 항목:
  - 제목
  - 프롬프트 요약
  - 카테고리
  - 좋아요 받은 횟수
  - 모델명
  - 작성일자
- 정렬: **좋아요 많은 순**
- 프롬프트 항목 클릭 시 → 해당 Q&A **상세 대화 페이지로 이동**

---

## 5. 나머지(결제, 프로필, 온체인)는 그대로 유지

- **결제 플로우**
  - `/api/chat`는 그대로 x402 미들웨어를 통해 보호.
  - 프롬프트당 USDC 결제 → pay_to_address = PaymentRouter(or Treasury) 컨트랙트 주소.
- **보상/리워드/업적 구조**
  - WeeklyVoteReward, BadgeReward 컨트랙트 설계는 기존 개요와 동일.
  - 랭킹/좋아요/공유 수 등은 **새 정의에 맞춰 집계**해서 사용하면 됨.
- **Profile/업적 페이지**
  - 인기 공유 프롬프트 리스트는
    - 지금 정의한 “유저 주소 클릭 시 나오는 인기 공유 프롬프트”와 동일한 데이터 소스를 사용 가능.

---

이렇게 바꾸면:

- **홈 → 공유 버튼 → LLM이 제목/카테고리 생성 → 대시보드 카드 생성**
- **카드/상세에서 좋아요 + 모델명/카테고리 탐색**
- **리더보드에서:**
  - 모델은 “얼마나 자주 공유되는지(Adoption Rate/Posted)”
  - 유저는 “얼마나 사랑받는(좋아요 + 공유수) Creator인지”

까지 한 흐름으로 쫙 이어지게 정리가 된다.
